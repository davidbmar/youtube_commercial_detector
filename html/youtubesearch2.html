<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Transcript Viewer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 {
            color: #cc0000;
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .control-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .dropdown-container {
            margin-bottom: 20px;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        #errorMessage {
            color: #cc0000;
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            display: none;
            background-color: #ffeeee;
            border-radius: 4px;
        }
        #loadingMessage {
            text-align: center;
            padding: 20px;
            color: #555;
        }
        .search-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .btn {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background-color: #aa0000;
        }
        .transcript-container {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .segment {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .segment:hover {
            background-color: #f5f5f5;
        }
        .segment-time {
            font-weight: bold;
            color: #555;
        }
        .segment-text {
            margin-top: 5px;
        }
        .segment-highlighted {
            background-color: #ffffd0;
        }
        .search-results {
            margin-top: 20px;
        }
        .result-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
        }
        .result-item:hover {
            background-color: #eeeeee;
        }
        .result-highlight {
            background-color: #ffffa0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>YouTube Transcript Viewer</h1>
    
    <div class="container">
        <div class="control-section">
            <div class="dropdown-container">
                <label for="videoSelect">Select a video:</label>
                <select id="videoSelect">
                    <option value="">Loading videos...</option>
                </select>
            </div>
            
            <div id="errorMessage"></div>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search for exact phrase...">
                <button id="searchButton" class="btn">Search</button>
            </div>
        </div>
        
        <div id="loadingMessage">Loading videos...</div>
        
        <div id="playerContainer" style="display: none;">
            <div id="player"></div>
        </div>
        
        <div id="searchResults" class="search-results" style="display: none;">
            <h2>Search Results</h2>
            <div id="resultsContainer"></div>
        </div>
        
        <div id="transcriptContainer" class="transcript-container" style="display: none;">
            <h2>Transcript</h2>
            <div id="segmentsContainer"></div>
        </div>
    </div>

    <script>
        // Configuration
        const S3_BUCKET_URL = "https://2025-03-15-youtube-transcripts.s3.us-east-2.amazonaws.com";
        
        // DOM elements
        const videoSelect = document.getElementById('videoSelect');
        const errorMessage = document.getElementById('errorMessage');
        const loadingMessage = document.getElementById('loadingMessage');
        const playerContainer = document.getElementById('playerContainer');
        const playerDiv = document.getElementById('player');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const searchResults = document.getElementById('searchResults');
        const resultsContainer = document.getElementById('resultsContainer');
        const transcriptContainer = document.getElementById('transcriptContainer');
        const segmentsContainer = document.getElementById('segmentsContainer');
        
        // State variables
        let videoIds = [];
        let currentVideoId = null;
        let transcriptSegments = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', initialize);
        
        // Event listeners
        videoSelect.addEventListener('change', handleVideoSelect);
        searchButton.addEventListener('click', searchTranscript);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchTranscript();
            }
        });
        
        // Initialize the application
        function initialize() {
            fetchVideoList();
        }
        
        // Fetch video list from S3
        async function fetchVideoList() {
            try {
                // Use the proper S3 bucket URL format to access the video_list.json file
                const listResponse = await fetch(`${S3_BUCKET_URL}/video_list.json`);
                
                if (!listResponse.ok) {
                    throw new Error(`Could not load video list: ${listResponse.status}`);
                }
                
                const data = await listResponse.json();
                let ids = [];
                
                // Handle different JSON structures
                if (Array.isArray(data)) {
                    // If it's an array of strings or objects
                    ids = data.map(item => {
                        if (typeof item === 'string') {
                            return item;
                        } else if (item && item.id) {
                            return item.id;
                        }
                        return null;
                    }).filter(id => id !== null);
                } else if (typeof data === 'object' && data !== null) {
                    // If it's an object with keys as identifiers
                    ids = Object.values(data).map(item => {
                        if (typeof item === 'string') {
                            return item;
                        } else if (item && item.id) {
                            return item.id;
                        }
                        return null;
                    }).filter(id => id !== null);
                }
                
                if (ids.length === 0) {
                    throw new Error('No video IDs found in the data');
                }
                
                // Set the video IDs
                videoIds = ids;
                
                // Populate the dropdown
                populateDropdown(videoIds);
                
                // Hide loading message
                loadingMessage.style.display = 'none';
                
                // Don't auto-select a video, let the user choose
                playerContainer.style.display = 'none';
                transcriptContainer.style.display = 'none';
            } catch (error) {
                showError(`Error loading video list: ${error.message}`);
                console.error('Error fetching video list:', error);
                loadingMessage.textContent = 'Could not load video list. Please check console for details.';
            }
        }
        
        // Populate dropdown with videos
        function populateDropdown(ids) {
            // Clear existing options
            videoSelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '-- Select a video --';
            defaultOption.selected = true;
            videoSelect.appendChild(defaultOption);
            
            // Add video options
            ids.forEach((id, index) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = `Video ${index + 1} - ${id}`;
                videoSelect.appendChild(option);
            });
        }
        
        // Handle video selection
        async function handleVideoSelect() {
            const selectedId = videoSelect.value;
            
            if (!selectedId) {
                playerDiv.innerHTML = '';
                transcriptContainer.style.display = 'none';
                searchResults.style.display = 'none';
                return;
            }
            
            currentVideoId = selectedId;
            
            // Show loading message
            loadingMessage.style.display = 'block';
            loadingMessage.textContent = 'Loading video and transcript...';
            
            // Display the YouTube player
            playerDiv.innerHTML = `
                <iframe 
                    src="https://www.youtube.com/embed/${selectedId}" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen
                ></iframe>
            `;
            playerContainer.style.display = 'block';
            
            // Clear previous transcript
            segmentsContainer.innerHTML = '';
            transcriptContainer.style.display = 'none';
            
            // Load the transcript
            await loadTranscript(selectedId);
            
            // Hide loading message
            loadingMessage.style.display = 'none';
        }
        
        // Load transcript for the selected video
        async function loadTranscript(videoId) {
            try {
                // Reset transcript segments
                transcriptSegments = [];
                
                // Fetch the list of segment files for this video
                const url = `${S3_BUCKET_URL}/transcripts/${videoId}/`;
                
                // Since we can't directly list S3 contents, we'll need to try to load each segment file
                // based on the pattern shown in the screenshot (segment_000.txt, segment_001.txt, etc.)
                let segmentIndex = 0;
                let hasMoreSegments = true;
                
                while (hasMoreSegments) {
                    const segmentNumber = segmentIndex.toString().padStart(3, '0');
                    const segmentUrl = `${url}segment_${segmentNumber}.txt`;
                    
                    try {
                        const response = await fetch(segmentUrl);
                        
                        if (!response.ok) {
                            hasMoreSegments = false;
                            continue;
                        }
                        
                        const text = await response.text();
                        
                        // Parse the segment (assuming a simple format with text content)
                        transcriptSegments.push({
                            index: segmentIndex,
                            number: segmentNumber,
                            text: text.trim()
                        });
                        
                        segmentIndex++;
                        
                        // Safety check to prevent infinite loops
                        if (segmentIndex > 100) {
                            hasMoreSegments = false;
                        }
                    } catch (error) {
                        console.error(`Error loading segment ${segmentNumber}:`, error);
                        hasMoreSegments = false;
                    }
                }
                
                // Display the transcript
                displayTranscript();
                
            } catch (error) {
                showError(`Error loading transcript: ${error.message}`);
                console.error('Error loading transcript:', error);
            }
        }
        
        // Display the transcript segments
        function displayTranscript() {
            if (transcriptSegments.length === 0) {
                segmentsContainer.innerHTML = '<p>No transcript available for this video.</p>';
                transcriptContainer.style.display = 'block';
                return;
            }
            
            // Clear previous content
            segmentsContainer.innerHTML = '';
            
            // Add each segment
            transcriptSegments.forEach(segment => {
                const segmentDiv = document.createElement('div');
                segmentDiv.className = 'segment';
                segmentDiv.id = `segment-${segment.number}`;
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'segment-time';
                timeDiv.textContent = `Segment ${segment.number}`;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'segment-text';
                textDiv.textContent = segment.text;
                
                segmentDiv.appendChild(timeDiv);
                segmentDiv.appendChild(textDiv);
                segmentsContainer.appendChild(segmentDiv);
            });
            
            // Show the transcript container
            transcriptContainer.style.display = 'block';
        }
        
        // Search the transcript for exact phrase
        function searchTranscript() {
            const searchTerm = searchInput.value.trim();
            
            if (!searchTerm) {
                showError('Please enter a search term');
                return;
            }
            
            if (transcriptSegments.length === 0) {
                showError('No transcript available to search');
                return;
            }
            
            // Clear previous results
            resultsContainer.innerHTML = '';
            
            // Find matches (case insensitive)
            const searchTermLower = searchTerm.toLowerCase();
            const matches = [];
            
            transcriptSegments.forEach(segment => {
                const textLower = segment.text.toLowerCase();
                const index = textLower.indexOf(searchTermLower);
                
                if (index !== -1) {
                    matches.push({
                        segment: segment,
                        index: index
                    });
                }
            });
            
            // Display search results
            if (matches.length === 0) {
                resultsContainer.innerHTML = '<p>No matches found.</p>';
            } else {
                matches.forEach(match => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    
                    const segmentNumber = match.segment.number;
                    const text = match.segment.text;
                    const searchIndex = match.index;
                    
                    // Create highlighted text
                    const beforeMatch = text.substring(0, searchIndex);
                    const matchText = text.substring(searchIndex, searchIndex + searchTerm.length);
                    const afterMatch = text.substring(searchIndex + searchTerm.length);
                    
                    resultDiv.innerHTML = `
                        <div class="segment-time">Segment ${segmentNumber}</div>
                        <div class="segment-text">
                            ${beforeMatch}<span class="result-highlight">${matchText}</span>${afterMatch}
                        </div>
                    `;
                    
                    // Add click handler to jump to the segment
                    resultDiv.addEventListener('click', () => {
                        // Highlight the segment in the transcript
                        const segments = document.querySelectorAll('.segment');
                        segments.forEach(seg => seg.classList.remove('segment-highlighted'));
                        
                        const segmentElement = document.getElementById(`segment-${segmentNumber}`);
                        if (segmentElement) {
                            segmentElement.classList.add('segment-highlighted');
                            segmentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                    
                    resultsContainer.appendChild(resultDiv);
                });
            }
            
            // Show search results
            searchResults.style.display = 'block';
        }
        
        // Function to show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
